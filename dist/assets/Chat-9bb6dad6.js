import{d as v,g as f,o as i,c as _,b as a,n as y,e as h,p as $,k as x,_ as k,m as g,t as C,r as w,j as T,q as j,T as A,F as I,i as L,s as S,v as F,x as E,y as R,z as b,A as B,B as U,C as M}from"./index-6ba6c52a.js";import{c as V,a as z,s as D}from"./axios-2a69e283.js";const W=e=>($("data-v-5d30104e"),e=e(),x(),e),q={class:"header-container"},G={class:"icon"},K=W(()=>a("div",{class:"time"},null,-1)),P=v({__name:"Header",setup(e){const t=f();return(n,o)=>(i(),_("div",q,[a("div",G,[a("div",{class:y(["status",{online:h(t).isOnline,offline:!h(t).isOnline}])},null,2)]),K]))}});const J=k(P,[["__scopeId","data-v-5d30104e"]]);const H=e=>($("data-v-45660008"),e=e(),x(),e),Q=["data-contact-id"],X=H(()=>a("div",{class:"contact-column"},[a("div",{class:"icon"})],-1)),Y={class:"contact-column text-part"},Z={class:"contact-row"},ee={class:"name"},te=H(()=>a("p",{class:"time"},"today",-1)),se=v({__name:"Contact",props:{avatar:null,name:null,_id:null,date:null,lastMessage:null,isCurrentConvo:{type:Boolean}},setup(e){const t=e,n=f();function o(r){let u=t._id;t._id!==n.getTalkingTo&&n.setTalkingTo(u)}return g(()=>{}),(r,u)=>(i(),_("div",{class:y(["contact-container",{active:t.isCurrentConvo}]),"data-contact-id":t._id,onClick:o},[X,a("div",Y,[a("div",Z,[a("p",ee,C(t.name),1),te])])],10,Q))}});const ne=k(se,[["__scopeId","data-v-45660008"]]),ae={class:"chat-list-container"},oe=v({__name:"ChatList",props:{selectedChat:null},setup(e){const t=e,n=w(!0),o=f();return g(()=>{n.value=!0,setTimeout(()=>{n.value=!1},2e3)}),(r,u)=>(i(),_("div",ae,[T(A,{name:"chat-list"},{default:j(()=>[(i(!0),_(I,null,L(t.selectedChat,d=>(i(),S(ne,{_id:d._id,name:d.username,key:d._id,"is-current-convo":d._id==h(o).getTalkingTo},null,8,["_id","name","is-current-convo"]))),128))]),_:1})]))}});const ce=k(oe,[["__scopeId","data-v-ab401dae"]]),O=F("message",{state:()=>({messages:new Map}),getters:{getMessages:e=>t=>e.messages.get(t)},actions:{pushMessage(e,t){var n;this.messages.get(e)!==void 0?(n=this.messages.get(e))==null||n.push(t):this.messages.set(e,[t]),console.log("pinia store: pushing message",t,"message length:",this.messages.get(e).length)}}});function le(e,t){let n=null,o=this;return(...r)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e.apply(o,r),n=null},t)}}function ie(e){let t=e.split(";");return{from:t[0],content:t.slice(2).join("")}}let m=null,re=f();const de=O();function _e(){m=new WebSocket(V),m.onerror=e=>{console.log("socket error",e)},m.onopen=e=>{console.log("socket established"),setTimeout(()=>re.setOnline(!0),1e3)},m.onclose=e=>{console.log("socket is closing",e)},m.onmessage=e=>{console.log(e.data);let t=ie(e.data);de.pushMessage(t.from,t)}}function ue(e){m==null||m.send(e)}const pe={class:"people"},he=v({__name:"Message",props:{from:null,content:null},setup(e){const t=e;g(()=>{console.log("message is mounted")});const n=f(),o=E(()=>n.getId==t.from),r=E(()=>localStorage.getItem(t.from));return(u,d)=>(i(),_("div",{class:y(["message-row",{"my-message-row":h(o)}])},[a("div",pe,C(h(r)),1),a("div",{class:y(["message",{"my-message":h(o)}])},C(t.content),3)],2))}}),me={class:"chat-content"},ge={class:"message-container"},ve=a("div",{class:"place-holder"},null,-1),fe=a("div",{class:"input-box"},[a("input",{type:"text",id:"chat-input"})],-1),ye=v({__name:"ChatContent",props:{currentTalking:null},setup(e){const t=e,n=f(),o=O(),{getMessages:r}=R(o);function u(){const p=n.getId,s=n.getTalkingTo,c=document.getElementById("chat-input"),l=c.value;l.length&&(console.log("sending message:",p+";"+s+";"+l),ue(p+";"+s+";"+l),o.pushMessage(s,{from:p,content:l}),c.value="")}function d(p){p.key=="Enter"&&u()}return g(()=>{document.addEventListener("keydown",d)}),b(()=>{document.removeEventListener("keydown",d)}),(p,s)=>(i(),_("div",me,[a("div",ge,[(i(!0),_(I,null,L(h(r)(t.currentTalking),c=>(i(),S(he,{from:c.from,content:c.content},null,8,["from","content"]))),256)),ve]),a("div",{class:"input-wrapper"},[fe,a("div",{class:"send-btn",onClick:u},"send")])]))}});const N=e=>($("data-v-9f79919e"),e=e(),x(),e),ke={class:"search-modal-wrapper"},Ce=N(()=>a("div",{class:"search-bar"},[a("input",{type:"text",class:"search-input",id:"search-input"})],-1)),Se={class:"search-result"},$e={key:0},xe=N(()=>a("div",{class:"list-item"}," Start searching for users ",-1)),Te=[xe],we={key:1},Ie=["data-v"],Le=v({__name:"Search",emits:["close-search"],setup(e,{emit:t}){const n={data:[]},o=B({data:[]}),r=w(!1);async function u(s){console.log("filtering",s.target.value);let c=s.target.value;o.data=[],await U(),c!==""&&n.data.filter(l=>{l.username.includes(c)&&o.data.push(l)})}function d(s){console.log(s.target.getAttribute("data-v"));let c=s.target.getAttribute("data-v"),l=s.target.innerText;localStorage.getItem(c)===null?(localStorage.setItem(c,l),t("close-search",{_id:c,username:l})):(console.log("already selected this"),t("close-search",{})),r.value=!0}let p=le(u,1e3);return g(()=>{var s;z.get(D+"/users",{withCredentials:!0}).then(c=>{c.data.data.map(l=>n.data.push(l))}).catch(c=>{console.log(c)}),(s=document.getElementById("search-input"))==null||s.addEventListener("input",p)}),b(()=>{var s;(s=document.getElementById("search-input"))==null||s.removeEventListener("input",p)}),(s,c)=>(i(),_("div",ke,[a("div",{class:y(["modal",{onclose:r.value}])},null,2),a("div",{class:y(["search-container",{onclose:r.value}])},[Ce,a("div",Se,[o.data.length==0?(i(),_("div",$e,Te)):(i(),_("div",we,[(i(!0),_(I,null,L(o.data,l=>(i(),_("div",{class:"list-item","data-v":l._id,key:l._id,onClick:d},C(l.username),9,Ie))),128))]))])],2)]))}});const be=k(Le,[["__scopeId","data-v-9f79919e"]]),Ee=e=>($("data-v-d3a07caf"),e=e(),x(),e),Me={class:"chat-container base-shadow-div"},Be={class:"chat-content-container"},He=Ee(()=>a("div",{class:"prompt"}," Press Ctrl+F to search for user ",-1)),Oe=v({__name:"Chat",setup(e){const t=f(),n=w(!1),o=B({data:[]});let r=!1;function u(s){s.ctrlKey&&(console.log("ctrl"),r=!0),s.key==="f"&&r&&(s.preventDefault(),n.value=!0,r=!1)}function d(s){n.value&&s.target.className=="modal"&&(n.value=!1)}function p(s){setTimeout(()=>{n.value=!1,s._id!==void 0&&o.data.splice(0,0,s)},1e3)}return g(()=>{_e(),document.addEventListener("keydown",u),document.addEventListener("click",d)}),g(()=>{Object.entries(localStorage).map(s=>{let[c,l]=s;o.data.push({_id:c,username:l})})}),b(()=>{document.removeEventListener("keydown",u),document.removeEventListener("click",d)}),(s,c)=>(i(),_("div",Me,[T(J),a("div",Be,[T(ce,{"selected-chat":o.data},null,8,["selected-chat"]),h(t).getTalkingTo!==""?(i(),S(ye,{key:0,"current-talking":h(t).getTalkingTo},null,8,["current-talking"])):M("",!0)]),He,n.value?(i(),S(be,{key:0,onCloseSearch:p})):M("",!0)]))}});const Ae=k(Oe,[["__scopeId","data-v-d3a07caf"]]);export{Ae as default};
